<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پنل مدیریت - پروژه‌ها</title>
</head>
<body>
    <h1>مدیریت پروژه‌ها</h1>
    <form id="project-form" onsubmit="saveProject(event)">
        <label for="project-name">نام پروژه</label>
        <input id="project-name" placeholder="نام پروژه" required />
        <br />
        <label for="project-description">توضیحات پروژه</label>
        <input id="project-description" placeholder="توضیحات پروژه" required />
        <br />
        <label for="project-link">لینک پروژه</label>
        <input id="project-link" placeholder="لینک پروژه" required />
        <br />
        <button type="submit">ثبت پروژه</button>
    </form>

    <h2>پروژه‌ها</h2>
    <div id="projects-container"></div>

    <script>
        const token = "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";
        const username = "KANEKI757";
        const repo = "Kaneki-Graph";
        const filePath = "data/projects.json";

        async function saveProject(event) {
            event.preventDefault();

            const name = document.getElementById("project-name").value;
            const description = document.getElementById("project-description").value;
            const link = document.getElementById("project-link").value;

            const newProject = { name, description, link };

            const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${filePath}`;

            const response = await fetch(apiUrl, {
                headers: { Authorization: `token ${token}` },
            });
            const data = await response.json();
            const content = JSON.parse(atob(data.content));
            content.push(newProject);

            const updatedContent = btoa(JSON.stringify(content, null, 2));

            await fetch(apiUrl, {
                method: "PUT",
                headers: {
                    Authorization: `token ${token}`,
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    message: "Add new project",
                    content: updatedContent,
                    sha: data.sha,
                }),
            });

            alert("پروژه با موفقیت ذخیره شد!");
            document.getElementById("project-form").reset();
        }

        async function loadProjects() {
            const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${filePath}`;
            const response = await fetch(apiUrl, {
                headers: { Authorization: `token ${token}` },
            });
            const data = await response.json();
            const content = JSON.parse(atob(data.content));

            const projectsContainer = document.getElementById("projects-container");
            content.forEach((project) => {
                const projectDiv = document.createElement("div");
                projectDiv.innerHTML = `
                    <h3>${project.name}</h3>
                    <p>${project.description}</p>
                    <a href="${project.link}" target="_blank">مشاهده پروژه</a>
                `;
                projectsContainer.appendChild(projectDiv);
            });
        }

        loadProjects();
    </script>
</body>
</html>
